<!DOCTYPE html>
<html>
<head>
    <title>Test Edge Function</title>
</head>
<body>
    <h1>Edge Function Test</h1>
    <button onclick="testFunction()">Test secure-paypal-checkout</button>
    <div id="result"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://rpzkugodaacelruquhtc.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJwemt1Z29kYWFjZWxydXF1aHRjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjU2NDI4NzEsImV4cCI6MjA0MTIxODg3MX0.YWvLf6WdRJJGJYVlJT_5Zt9Uw7Lp9Ej_Ky2Uw9Uw9Ow' // Replace with your anon key
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)

        async function testFunction() {
            const resultDiv = document.getElementById('result')
            resultDiv.innerHTML = 'Testing...'

            try {
                // First check if user is authenticated
                const { data: { session } } = await supabase.auth.getSession()
                
                if (!session) {
                    resultDiv.innerHTML = '<p style="color: red;">❌ Not authenticated. Please log in first.</p>'
                    return
                }

                // Test the Edge Function
                const response = await fetch(`${supabaseUrl}/functions/v1/secure-paypal-checkout`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${session.access_token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ package_id: 'premium' })
                })

                const data = await response.json()
                
                if (response.ok) {
                    resultDiv.innerHTML = `<p style="color: green;">✅ Success!</p><pre>${JSON.stringify(data, null, 2)}</pre>`
                } else {
                    resultDiv.innerHTML = `<p style="color: red;">❌ Error ${response.status}</p><pre>${JSON.stringify(data, null, 2)}</pre>`
                }
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">❌ Network Error: ${error.message}</p>`
            }
        }

        // Check authentication status on load
        window.onload = async () => {
            const { data: { session } } = await supabase.auth.getSession()
            if (session) {
                document.getElementById('result').innerHTML = `<p style="color: green;">✅ Authenticated as: ${session.user.email}</p>`
            } else {
                document.getElementById('result').innerHTML = `<p style="color: orange;">⚠️ Not authenticated. Please log in to your app first.</p>`
            }
        }
    </script>
</body>
</html>
